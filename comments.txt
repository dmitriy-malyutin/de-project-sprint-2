Мария, привет!
Большое спасибо за разбор.
По комментариям:
	1. Исправил ошибку при создании ключа, перенёс этот этап в создание таблицы.
	2. Убрал все SEQUENCE
	3. Ошибка в пункте 4.2 
  Error executing query:
  SQL Error [23503]: ERROR: insert or update on table "shipping_info" violates foreign key constraint "shipping_id_fk"
  Подробности: Key (shipping_id)=(54175) is not present in table "shipping_status" 
  у меня не воспроизводится, данные корректно инсертятся. Предполагаю, что проблема была связана с первым пунктом.
    4. Полностью передалал инсерт в пункте 5.2 - спасибо за замечание про уникальность значения state_datetime, в случае, если статус присваивался несколько раз - не подумал об этом. Однако, при добавлении MAX(state_datetime) в старую версию CTE, запрос стал отрабатывать вместо ~0,5 сек около 11 секунд, что, как мне кажется, не есть хорошо. Переделал - стало отрабатывать за 125 мс.
	5. Вынес все проверки данных в отдельные файлы - теперь их два, check_data_before и check_data_after
	6. Спасибо за замечание про AGE и EXTRACT - я не знал про функцию EXTRACT.
Кажется, что все замечания разобрал.
Буду рад новым комментариям :)